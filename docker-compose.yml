services:
  linkedin:
    build:
      context: ./linkedin
      dockerfile: Dockerfile
    image: 'mcp-linkedin:latest'
    pull_policy: build
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-s", "--max-time", "5", "-o", "/dev/null", "http://localhost:8080/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    labels:
      - traefik.enable=true
      - 'traefik.http.routers.mcp-linkedin.rule=Host(`linkedin.mcp.lasupermachine.fr`)'
      - traefik.http.routers.mcp-linkedin.entrypoints=https
      - traefik.http.routers.mcp-linkedin.tls.certresolver=letsencrypt
      - traefik.http.services.mcp-linkedin.loadbalancer.server.port=8080
    networks:
      - coolify

  annuaire:
    build:
      context: ./annuaire
      dockerfile: Dockerfile
    image: 'mcp-annuaire:latest'
    pull_policy: build
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-s", "--max-time", "5", "-o", "/dev/null", "http://localhost:8080/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    labels:
      - traefik.enable=true
      - 'traefik.http.routers.mcp-annuaire.rule=Host(`annuaire.mcp.lasupermachine.fr`)'
      - traefik.http.routers.mcp-annuaire.entrypoints=https
      - traefik.http.routers.mcp-annuaire.tls.certresolver=letsencrypt
      - traefik.http.services.mcp-annuaire.loadbalancer.server.port=8080
    networks:
      - coolify

  serp:
    build:
      context: ./serp
      dockerfile: Dockerfile
    image: 'mcp-serp:latest'
    pull_policy: build
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-s", "--max-time", "5", "-o", "/dev/null", "http://localhost:8080/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    labels:
      - traefik.enable=true
      - 'traefik.http.routers.mcp-serp.rule=Host(`serp.mcp.lasupermachine.fr`)'
      - traefik.http.routers.mcp-serp.entrypoints=https
      - traefik.http.routers.mcp-serp.tls.certresolver=letsencrypt
      - traefik.http.services.mcp-serp.loadbalancer.server.port=8080
    networks:
      - coolify

  rdap:
    build:
      context: ./rdap
      dockerfile: Dockerfile
    image: 'mcp-rdap:latest'
    pull_policy: build
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-s", "--max-time", "5", "-o", "/dev/null", "http://localhost:8080/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    labels:
      - traefik.enable=true
      - 'traefik.http.routers.mcp-rdap.rule=Host(`rdap.mcp.lasupermachine.fr`)'
      - traefik.http.routers.mcp-rdap.entrypoints=https
      - traefik.http.routers.mcp-rdap.tls.certresolver=letsencrypt
      - traefik.http.services.mcp-rdap.loadbalancer.server.port=8080
    networks:
      - coolify

  siret-extractor:
    build:
      context: ./siret-extractor
      dockerfile: Dockerfile
    image: 'mcp-siret-extractor:latest'
    pull_policy: build
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-s", "--max-time", "5", "-o", "/dev/null", "http://localhost:8080/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    labels:
      - traefik.enable=true
      - 'traefik.http.routers.mcp-siret-extractor.rule=Host(`siret-extractor.mcp.lasupermachine.fr`)'
      - traefik.http.routers.mcp-siret-extractor.entrypoints=https
      - traefik.http.routers.mcp-siret-extractor.tls.certresolver=letsencrypt
      - traefik.http.services.mcp-siret-extractor.loadbalancer.server.port=8080
    networks:
      - coolify

  supabase:
    build:
      context: ./supabase
      dockerfile: Dockerfile
    image: 'mcp-supabase:latest'
    pull_policy: build
    restart: unless-stopped
    environment:
      - SUPABASE_URL=https://supabase.lasupermachine.fr
      - SUPABASE_ANON_KEY=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJzdXBhYmFzZSIsImlhdCI6MTc2MTg4MjE4MCwiZXhwIjo0OTE3NTU1NzgwLCJyb2xlIjoiYW5vbiJ9.jtdQs0VsEWvZI0tz0jxslqCqo6lhcEt08V6__vsfhgU
      - SUPABASE_SERVICE_KEY=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJzdXBhYmFzZSIsImlhdCI6MTc2MTg4MjE4MCwiZXhwIjo0OTE3NTU1NzgwLCJyb2xlIjoic2VydmljZV9yb2xlIn0.5ybxQEB0GmjAhJwZR9eItS7s9VH7zAEl8CAj6Z3KhOs
    healthcheck:
      test: ["CMD", "curl", "-s", "--max-time", "5", "-o", "/dev/null", "http://localhost:8080/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    labels:
      - traefik.enable=true
      - 'traefik.http.routers.mcp-supabase.rule=Host(`supabase.mcp.lasupermachine.fr`)'
      - traefik.http.routers.mcp-supabase.entrypoints=https
      - traefik.http.routers.mcp-supabase.tls.certresolver=letsencrypt
      - traefik.http.services.mcp-supabase.loadbalancer.server.port=8080
    networks:
      - coolify

networks:
  coolify:
    external: true
